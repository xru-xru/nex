import { Meta, StoryFn } from '@storybook/react';
import React from 'react';
import { mock_decorators } from '../../../.storybook/preview.jsx';
import PortfolioPerformanceChart from '../../components/Charts/PortfolioPerformanceChart';
import usePortfolioEventsStore from '../../store/portfolio-events';

export default {
  title: 'Portfolio Events/Performance chart',
  component: PortfolioPerformanceChart,
  decorators: mock_decorators(),
  parameters: {
    docs: {
      description: {
        component:
          'This story demonstrates the Portfolio performance chart component with pre-populated events from the store.',
      },
    },
    controls: {
      sort: 'requiredFirst',
    },
  },
  tags: ['autodocs'],
  argTypes: {
    events: {
      control: 'object',
      description: 'Portfolio events to display on the chart',
    },
  },
} as Meta;

const mockEvents = [
  {
    __typename: 'PortfolioEvent',
    portfolioEventId: 2932,
    name: 'Social media trend',
    category: 'POSITIVE_EXTERNAL_EFFECTS',
    created: '2025-06-04',
    description: 'Social media trend related to our product category',
    start: '2025-04-15',
    end: '2025-05-17',
    impact: 'SMALL',
    includesAllContents: true,
    assetUrl: null,
    contentRules: [],
    assignedContents: [],
  },
  {
    __typename: 'PortfolioEvent',
    portfolioEventId: 2934,
    name: 'Brand Awareness Push',
    category: 'BRAND_AWARENESS',
    created: '2025-06-04',
    description: '',
    start: '2025-04-28',
    end: '2025-05-08',
    impact: 'SMALL',
    includesAllContents: true,
    assetUrl: null,
    contentRules: [],
    assignedContents: [],
  },
  {
    __typename: 'PortfolioEvent',
    portfolioEventId: 2937,
    name: 'High season',
    category: 'POSITIVE_EXTERNAL_EFFECTS',
    created: '2025-06-04',
    description: '',
    start: '2025-05-11',
    end: '2025-08-10',
    impact: 'SMALL',
    includesAllContents: true,
    assetUrl: null,
    contentRules: [],
    assignedContents: [],
  },
];
const mockData = [
  {
    '12': 2260.3099975585938,
    '24': 1528.5660592913628,
    '34': 2831.5269317626958,
    '35': 322.635986328125,
    '36': 730.0820007324219,
    '45': 592.9316512532532,
    '48': 0,
    '20323': 4634.362998962402,
    '20324': 36.38999938964844,
    '20325': 3594.639628548175,
    '20326': 0.6600000262260437,
    '20327': 0,
    '20328': 0,
    '27548': 8266.052626926452,
    '27549': 0,
    timestamp: '2025-05-05',
    value: 8266.052626926452,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 413.3399963378906,
    '24': 1463.8782091140747,
    '34': 5321.568099975586,
    '35': 566.2449951171875,
    '36': 478.5450134277344,
    '45': 402.1150131225586,
    '48': 0,
    '20323': 6823.591112136841,
    '20324': 79.95999908447266,
    '20325': 1722.3050155639648,
    '20326': 19.835200309753414,
    '20327': 0,
    '20328': 0,
    '27548': 8645.691327095032,
    '27549': 0,
    timestamp: '2025-05-06',
    value: 8645.691327095032,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 284.989990234375,
    '24': 1327.9646801948547,
    '34': 4812.9940757751465,
    '35': 413.0255012512207,
    '36': 1132.926010131836,
    '45': 792.4291181564331,
    '48': 0,
    '20323': 6339.9318652153015,
    '20324': 16.389999389648438,
    '20325': 2399.9406309127808,
    '20326': 8.066880226135254,
    '20327': 0,
    '20328': 0,
    '27548': 8764.329375743866,
    '27549': 0,
    timestamp: '2025-05-07',
    value: 8764.329375743866,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 193.27999687194824,
    '24': 1647.0394954681396,
    '34': 4244.830017089844,
    '35': 270.0014991760254,
    '36': 1543.1559448242188,
    '45': 876.8984222412109,
    '48': 0,
    '20323': 5553.349016189575,
    '20324': 211.26000213623047,
    '20325': 2972.13685798645,
    '20326': 38.45949935913086,
    '20327': 0,
    '20328': 0,
    '27548': 8775.205375671387,
    '27549': 0,
    timestamp: '2025-05-08',
    value: 8775.205375671387,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 449.9299926757813,
    '24': 1497.701400756836,
    '34': 3892.4117708206177,
    '35': 767.0689697265625,
    '36': 653.947998046875,
    '45': 447.7937135696411,
    '48': 0,
    '20323': 5569.187766075134,
    '20324': 9.489999771118164,
    '20325': 2130.176079750061,
    '20326': 0,
    '20327': 0,
    '20328': 0,
    '27548': 7708.8538455963135,
    '27549': 0,
    timestamp: '2025-05-09',
    value: 7708.8538455963135,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 878.8199768066406,
    '24': 1675.334501117468,
    '34': 3462.6137771606445,
    '35': 821,
    '36': 902.239990234375,
    '45': 625,
    '48': 0,
    '20323': 5691.219722747803,
    '20324': 0,
    '20325': 2668.742950439453,
    '20326': 6.458535999059677,
    '20327': 0,
    '20328': 0,
    '27548': 8366.421209186316,
    '27549': 0,
    timestamp: '2025-05-10',
    value: 8366.421209186316,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 752.0800170898438,
    '24': 583.6020307540894,
    '34': 2733.179016113281,
    '35': 93.881103515625,
    '36': 999.5780334472656,
    '45': 1541.739990234375,
    '48': 0,
    '20323': 3260.6200256347656,
    '20324': 54.970001220703125,
    '20325': 3387.2791442871094,
    '20326': 1.1910200119018557,
    '20327': 0,
    '20328': 0,
    '27548': 6704.06019115448,
    '27549': 0,
    timestamp: '2025-05-11',
    value: 6704.06019115448,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 155.1300048828125,
    '24': 1094.1369827985764,
    '34': 2122.2110290527344,
    '35': 231.10400390625,
    '36': 423.05299377441406,
    '45': 1154.3299560546875,
    '48': 0,
    '20323': 3219.165014266968,
    '20324': 119.94000244140624,
    '20325': 1808.486953735352,
    '20326': 32.37300002574921,
    '20327': 0,
    '20328': 0,
    '27548': 5179.964970469475,
    '27549': 0,
    timestamp: '2025-05-12',
    value: 5179.964970469475,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 211.6699981689453,
    '24': 964.9753843545914,
    '34': 1723.6715850830078,
    '35': 458.3970031738281,
    '36': 647.6959838867188,
    '45': 490.171989440918,
    '48': 0,
    '20323': 2878.6029673814774,
    '20324': 0,
    '20325': 1596.2649765014648,
    '20326': 21.71400022506714,
    '20327': 0,
    '20328': 0,
    '27548': 4496.581944108009,
    '27549': 0,
    timestamp: '2025-05-13',
    value: 4496.581944108009,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 416.3900146484375,
    '24': 2190.7322998046875,
    '34': 2333.398971557617,
    '35': 674,
    '36': 596.60400390625,
    '45': 1284.7900314331057,
    '48': 0,
    '20323': 4262.826984405518,
    '20324': 377.8200073242188,
    '20325': 2639.7673377990723,
    '20326': 215.9409942626953,
    '20327': 0,
    '20328': 0,
    '27548': 7496.355323791504,
    '27549': 0,
    timestamp: '2025-05-14',
    value: 7496.355323791504,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 558.950008392334,
    '24': 1716.0725965499878,
    '34': 2606.08903503418,
    '35': 574.3099975585938,
    '36': 659.4599914550781,
    '45': 618.801025390625,
    '48': 0,
    '20323': 4725.786842346191,
    '20324': 43.88999938964844,
    '20325': 1912.726014137268,
    '20326': 51.27979850769043,
    '20327': 0,
    '20328': 0,
    '27548': 6733.682654380798,
    '27549': 0,
    timestamp: '2025-05-15',
    value: 6733.682654380798,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 1524.2599487304688,
    '24': 1646.7609714269638,
    '34': 2154.33895111084,
    '35': 628.1920166015625,
    '36': 1590.145965576172,
    '45': 647,
    '48': 0,
    '20323': 4847.019874572754,
    '20324': 56.959999084472656,
    '20325': 3286.3789978027344,
    '20326': 1.3200000524520874,
    '20327': 0,
    '20328': 0,
    '27548': 8191.678871512413,
    '27549': 0,
    timestamp: '2025-05-16',
    value: 8191.678871512413,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 582.2599945068359,
    '24': 1369.4939767718315,
    '34': 2925.804992675781,
    '35': 589.625316619873,
    '36': 818.9550170898438,
    '45': 1995.2099609375,
    '48': 0,
    '20323': 4700.638961791992,
    '20324': 0,
    '20325': 3477.000293731689,
    '20326': 0.6600000262260437,
    '20327': 103.0500030517578,
    '20328': 0,
    '27548': 8281.349258601665,
    '27549': 0,
    timestamp: '2025-05-17',
    value: 8281.349258601665,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
  {
    '12': 686.5,
    '24': 4694.438009500504,
    '34': 1770.7723274230957,
    '35': 984.5260009765624,
    '36': 1492.2869873046875,
    '45': 1608.3599853515625,
    '48': 0,
    '20323': 6659.450336456299,
    '20324': 158.78000164031982,
    '20325': 4085.172973632813,
    '20326': 2.200000047683716,
    '20327': 331.2799987792969,
    '20328': 0,
    '27548': 11236.883310556412,
    '27549': 0,
    timestamp: '2025-05-18',
    value: 11236.883310556412,
    optimizationPotentialValue: 41310.1,
    optimizationPotentialPercentage: 4.58,
  },
];

const setStoreData = (events: any[]) => {
  const { setPortfolioEvents, setShowEvents } = usePortfolioEventsStore.getState();

  setShowEvents(true);

  setPortfolioEvents(events);
};

const Template: StoryFn = ({ events }) => {
  setStoreData(events);
  return (
    <PortfolioPerformanceChart
      data={mockData}
      validationData={[]}
      validationTooltip={[]}
      portfolioId={1}
      optimizations={[]}
      portfolioTitle="Test Portfolio"
    />
  );
};

export const Default = Template.bind({});
Default.args = {
  events: mockEvents,
};
